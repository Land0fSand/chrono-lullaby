# ğŸ“¦ å‘é€è®°å½•åŠŸèƒ½æ›´æ–°æ—¥å¿—

**æ›´æ–°æ—¥æœŸ**: 2025-10-10  
**ç‰ˆæœ¬**: v2.1

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. **æ¯ä¸ªTGé¢‘é“ç‹¬ç«‹çš„å‘é€è®°å½•**

ä¹‹å‰ï¼šBotå‘é€æ–‡ä»¶åç›´æ¥åˆ é™¤ï¼Œæ— ä»»ä½•è®°å½•  
ç°åœ¨ï¼šæ¯ä¸ªTelegramé¢‘é“ç»´æŠ¤ç‹¬ç«‹çš„å‘é€è®°å½•

**è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶**ï¼š
- `data/sent_archive_{CHAT_ID}.txt` - æœºå™¨æ ¼å¼ï¼ˆyt-dlpå…¼å®¹ï¼‰
- `data/sent_archive_{CHAT_ID}_readable.txt` - äººç±»å¯è¯»æ ¼å¼ï¼ˆå¸¦è§†é¢‘æ ‡é¢˜ï¼‰

**ç¤ºä¾‹**ï¼š
```
# æœºå™¨æ ¼å¼ (sent_archive_1002441077579.txt)
youtube cBUvP4MPfcc
youtube sbK0XHQ5QRw

# äººç±»å¯è¯»æ ¼å¼ (sent_archive_1002441077579_readable.txt)
cBUvP4MPfcc [ã€å…³ç¯æ‹†ç”µå½±ã€‘å›½é™…æ‚¬èµä»¤ï¼šé€šç¼‰æ‹œç™»ã€åŠ å…°ã€éº¦åº·è¯ºã€å·æ™®ä»¥åŠä½©æ´›è¥¿ç­‰ã€‚]
sbK0XHQ5QRw [ã€å…³ç¯æ‹†ç”µå½±ã€‘ç½—æ–¯æŸ´å°”å¾·ä¸é‡‘èçš„æˆ˜äº‰ã€‚]
```

---

### 2. **ä¾¿æ·çš„æŸ¥çœ‹å·¥å…·**

æ–°å¢ PowerShell è„šæœ¬ï¼Œå¿«é€ŸæŸ¥çœ‹å‘é€è®°å½•ï¼š

```powershell
# æŸ¥çœ‹æ‰€æœ‰é¢‘é“çš„å‘é€è®°å½•
.\scripts\view_sent_records.ps1 -All

# æŸ¥çœ‹ç‰¹å®šé¢‘é“
.\scripts\view_sent_records.ps1 -ChatId -1002441077579

# åªçœ‹æœ€è¿‘10æ¡
.\scripts\view_sent_records.ps1 -ChatId -1002441077579 -Tail 10

# æŸ¥çœ‹æ‰€æœ‰é¢‘é“çš„æœ€è¿‘5æ¡
.\scripts\view_sent_records.ps1 -All -Tail 5
```

---

### 3. **å®Œå–„çš„æ–‡æ¡£**

æ–°å¢è¯¦ç»†çš„ Archive æ–‡ä»¶è¯´æ˜æ–‡æ¡£ï¼š
- ğŸ“„ `docs/ARCHIVE_FILES.md` - å®Œæ•´çš„ archive æ–‡ä»¶ä½“ç³»è¯´æ˜
- å·¥ä½œæµç¨‹å›¾ç¤º
- å¸¸è§é—®é¢˜è§£ç­”
- ç»´æŠ¤å»ºè®®

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒå‡½æ•°

#### 1. `extract_video_info_from_filename(filename: str)`
ä»æ–‡ä»¶åä¸­æå–è§†é¢‘IDå’Œæ ‡é¢˜

```python
# æ”¯æŒçš„æ–‡ä»¶åæ ¼å¼ï¼š
# - video_id.title.m4a
# - video_id.title_0.m4a (åˆ†æ®µæ–‡ä»¶)
# - video_id.title_1.m4a (åˆ†æ®µæ–‡ä»¶)

video_id, title = extract_video_info_from_filename("cBUvP4MPfcc.ã€å…³ç¯æ‹†ç”µå½±ã€‘å›½é™…æ‚¬èµä»¤.m4a")
# è¿”å›: ("cBUvP4MPfcc", "ã€å…³ç¯æ‹†ç”µå½±ã€‘å›½é™…æ‚¬èµä»¤")
```

#### 2. `record_sent_file(chat_id: str, video_id: str, title: str)`
è®°å½•å·²å‘é€çš„æ–‡ä»¶åˆ°ä¸¤ä¸ªarchiveæ–‡ä»¶

```python
# è‡ªåŠ¨å¤„ç†ï¼š
# 1. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆé¿å…é‡å¤è®°å½•ï¼‰
# 2. å†™å…¥æœºå™¨æ ¼å¼æ–‡ä»¶
# 3. å†™å…¥äººç±»å¯è¯»æ–‡ä»¶
# 4. è®°å½•æ—¥å¿—
```

#### 3. `get_sent_archive_path(chat_id: str, readable: bool = False)`
è·å–é¢‘é“archiveæ–‡ä»¶è·¯å¾„

```python
from config import get_sent_archive_path

# æœºå™¨æ ¼å¼
machine_path = get_sent_archive_path("-1002441077579", readable=False)
# è¿”å›: "D:/usr/.../data/sent_archive_1002441077579.txt"

# äººç±»å¯è¯»
readable_path = get_sent_archive_path("-1002441077579", readable=True)
# è¿”å›: "D:/usr/.../data/sent_archive_1002441077579_readable.txt"
```

---

## ğŸ“Š æ–‡ä»¶å‘½åè§„åˆ™

### Chat ID æ¸…ç†è§„åˆ™
- ç§»é™¤è´Ÿå· `-`
- ç§»é™¤åŠ å· `+`
- åªä¿ç•™æ•°å­—

### ç¤ºä¾‹

| Telegram Chat ID | æœºå™¨æ ¼å¼æ–‡ä»¶ | äººç±»å¯è¯»æ–‡ä»¶ |
|-----------------|-----------|-----------|
| `-1002441077579` | `sent_archive_1002441077579.txt` | `sent_archive_1002441077579_readable.txt` |
| `-1003009234603` | `sent_archive_1003009234603.txt` | `sent_archive_1003009234603_readable.txt` |

---

## ğŸ”„ å·¥ä½œæµç¨‹

```
Telegram Bot å‘é€æ–‡ä»¶
  â†“
å‘é€æˆåŠŸ
  â†“
extract_video_info_from_filename()  â† ä»æ–‡ä»¶åæå– video_id å’Œ title
  â†“
record_sent_file()  â† è®°å½•åˆ°ä¸¤ä¸ªarchiveæ–‡ä»¶
  â†“
åˆ é™¤éŸ³é¢‘æ–‡ä»¶
```

---

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```powershell
.\.venv\Scripts\python tests\test_sent_archive.py
```

æµ‹è¯•å†…å®¹ï¼š
1. âœ… æ–‡ä»¶åè§£æï¼ˆæ”¯æŒæ™®é€šæ–‡ä»¶å’Œåˆ†æ®µæ–‡ä»¶ï¼‰
2. âœ… Archive æ–‡ä»¶è·¯å¾„ç”Ÿæˆ
3. âœ… Chat ID æ¸…ç†è§„åˆ™

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

```
src/
  config.py                          â† æ–°å¢ get_sent_archive_path()
  task/
    send_file.py                     â† æ–°å¢è®°å½•åŠŸèƒ½

docs/
  ARCHIVE_FILES.md                   â† æ–°å¢ï¼šå®Œæ•´æ–‡æ¡£
  CHANGELOG_SENT_ARCHIVE.md          â† æ–°å¢ï¼šæ›´æ–°æ—¥å¿—

scripts/
  view_sent_records.ps1              â† æ–°å¢ï¼šæŸ¥çœ‹å·¥å…·

tests/
  test_sent_archive.py               â† æ–°å¢ï¼šæµ‹è¯•è„šæœ¬

config/
  config.yaml                        â† æ›´æ–°ï¼šarchiveè·¯å¾„è¯´æ˜
  config.yaml.example                â† æ›´æ–°ï¼šåŒæ­¥è¯´æ˜
```

---

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

| ç‰¹æ€§ | download_archive | sent_archive (æœºå™¨) | sent_archive (å¯è¯») |
|-----|-----------------|-------------------|-------------------|
| **ä½œç”¨åŸŸ** | å…¨å±€ï¼ˆæ‰€æœ‰é¢‘é“ç»„ï¼‰ | å•ä¸ª TG é¢‘é“ | å•ä¸ª TG é¢‘é“ |
| **æ ¼å¼** | yt-dlp æ ¼å¼ | yt-dlp æ ¼å¼ | äººç±»å¯è¯» |
| **ç”¨é€”** | é¿å…é‡å¤ä¸‹è½½ | è¿½è¸ªå‘é€å†å² | ç”¨æˆ·æŸ¥çœ‹ |
| **ç¨‹åºä½¿ç”¨** | âœ… yt-dlp è‡ªåŠ¨è¯»å– | âœ… å¯ç”¨äºé˜²é‡å¤ | âŒ ä»…ä¾›æŸ¥çœ‹ |

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **å®šæœŸæŸ¥çœ‹è®°å½•**ï¼šä½¿ç”¨ `view_sent_records.ps1` æ£€æŸ¥å‘é€å†å²
2. **æœç´¢ç‰¹å®šè§†é¢‘**ï¼šåœ¨ `*_readable.txt` ä¸­æœç´¢æ ‡é¢˜å…³é”®è¯
3. **å¤‡ä»½è®°å½•**ï¼šå®šæœŸå¤‡ä»½ `data/sent_archive_*.txt` æ–‡ä»¶
4. **æ¸…ç†æ—§è®°å½•**ï¼šå¦‚éœ€è¦ï¼Œå¯ä»¥æ‰‹åŠ¨å½’æ¡£æˆ–åˆ é™¤æ—§çš„è®°å½•æ–‡ä»¶

---

## ğŸ”® æœªæ¥å¯èƒ½çš„å¢å¼º

1. **é˜²é‡å¤å‘é€**ï¼šåŸºäº `sent_archive_*.txt` æ£€æŸ¥ï¼Œé¿å…é‡å¤å‘é€ç›¸åŒè§†é¢‘
2. **å‘é€ç»Ÿè®¡**ï¼šç”Ÿæˆæ¯ä¸ªé¢‘é“çš„å‘é€ç»Ÿè®¡æŠ¥å‘Š
3. **Webç•Œé¢**ï¼šå¯è§†åŒ–æŸ¥çœ‹å’Œç®¡ç†å‘é€è®°å½•
4. **è‡ªåŠ¨æ¸…ç†**ï¼šé…ç½®ä¿ç•™æœ€è¿‘Næ¡è®°å½•ï¼Œè‡ªåŠ¨å½’æ¡£æ—§è®°å½•

---

**å®Œæˆï¼** ğŸ‰

